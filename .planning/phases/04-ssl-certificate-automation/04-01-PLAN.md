---
phase: 04-ssl-certificate-automation
type: execute
---

<objective>
Create Certificate Pydantic models and validate API foundation for NPM certificate management.

Purpose: Establish type-safe models for Let's Encrypt certificate operations via NPM API, following the proven proxy host pattern from Phase 3.
Output: Certificate models (CertificateCreate, Certificate) with comprehensive test coverage, ready for NPMClient integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ssl-automation/04-RESEARCH.md
@.planning/phases/03-proxy-host-management/03-01-SUMMARY.md
@src/npm_cli/api/models.py
@src/npm_cli/api/exceptions.py
</context>

<tasks>

<task type="auto" tdd="true">
  <name>Task 1: Create Certificate Pydantic models</name>
  <files>src/npm_cli/api/models.py, tests/test_certificate_models.py</files>
  <test-first>
Test: Certificate models validate NPM API schema
Cases:
  - CertificateCreate with domain_names + meta → valid
  - CertificateCreate missing domain_names → validation error
  - Certificate includes read-only fields (id, created_on, modified_on, expires_on, owner_user_id)
  - Certificate with extra fields → ignored (extra="ignore")
  - Meta field validates letsencrypt_email present
  - Meta field accepts dns_provider and dns_provider_credentials (optional)
  </test-first>
  <action>
Add Certificate models to src/npm_cli/api/models.py following RESEARCH.md patterns:

1. CertificateCreate(BaseModel):
   - domain_names: list[str] (min_length=1) - first is primary, rest are SANs
   - meta: dict - must contain letsencrypt_email, optionally dns_provider/credentials
   - nice_name: str = "" - human-readable name
   - provider: Literal["letsencrypt"] = "letsencrypt"
   - model_config = ConfigDict(extra="ignore", strict=True)

2. Certificate(CertificateCreate):
   - Inherits from CertificateCreate (like ProxyHost inherits from ProxyHostCreate)
   - id: int (ge=1)
   - created_on: str - ISO 8601 timestamp
   - modified_on: str - ISO 8601 timestamp
   - expires_on: str - ISO 8601 timestamp
   - owner_user_id: int (ge=1)

Use extra="ignore" (NOT extra="forbid") per Phase 3 learning - NPM API returns additional fields.

Follow TDD: Write tests first in tests/test_certificate_models.py, verify they fail, then implement models.
  </action>
  <verify>uv run pytest tests/test_certificate_models.py -v passes all tests</verify>
  <done>Certificate models validate required fields, ignore extra fields, all tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] uv run pytest tests/test_certificate_models.py passes
- [ ] uv run ruff check src/ passes (no linting errors)
- [ ] Certificate models follow ProxyHost pattern (inheritance, extra="ignore")
- [ ] All validation rules match RESEARCH.md specifications
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Certificate models ready for NPMClient integration
- TDD workflow followed (RED → GREEN → REFACTOR)
- No TypeScript/linting errors
  </success_criteria>

<output>
After completion, create `.planning/phases/04-ssl-certificate-automation/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Certificate Models & API Foundation Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 04-02-PLAN.md (Certificate API Client Methods)
</output>
