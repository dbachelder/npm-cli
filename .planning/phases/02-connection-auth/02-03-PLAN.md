---
phase: 02-connection-auth
type: execute
---

<objective>
Implement user-facing CLI commands for NPM connection management.

Purpose: Enable users to configure NPM connection interactively and verify connectivity status.
Output: `npm-cli config init` and `npm-cli config status` commands with Rich-formatted output.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-connection-auth/02-RESEARCH.md
@.planning/phases/02-connection-auth/02-01-SUMMARY.md
@.planning/phases/02-connection-auth/02-02-SUMMARY.md
@src/npm_cli/cli/config.py
@src/npm_cli/config/settings.py
@src/npm_cli/docker/discovery.py
@src/npm_cli/api/client.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create config init command for interactive setup</name>
  <files>src/npm_cli/cli/config.py</files>
  <action>Update config.py to replace placeholder with init subcommand. Use typer.prompt() to interactively collect NPM_API_URL (default: http://localhost:81), NPM_USERNAME, NPM_PASSWORD (hide_input=True), NPM_CONTAINER_NAME (default: nginx-proxy-manager). Validate URL format. Write to .env file in current directory. Create .gitignore if missing and add .env if not present. Use Rich console for formatted output (success message, instructions). Show example: "Configuration saved to .env. Run 'npm-cli config status' to verify connection."</action>
  <verify>uv run npm-cli config init prompts for values, creates .env with correct format, adds to .gitignore</verify>
  <done>Users can run config init, enter credentials interactively, get .env file created with proper .gitignore protection</done>
</task>

<task type="auto">
  <name>Task 2: Create config status command for connection verification</name>
  <files>src/npm_cli/cli/config.py</files>
  <action>Add status subcommand to config.py. Load NPMSettings from environment. Display using Rich table/panel: 1) NPM API URL (from config), 2) Docker Discovery status (try Docker discovery, show container found/not found/Docker unavailable), 3) Container name if found, 4) Token status (try loading from ~/.npm-cli/token.json, show valid/expired/missing with expiry time if present), 5) Connection test (if token valid, try GET request to NPM API to verify connectivity). Use Rich colors: green for success, yellow for warnings, red for errors. Handle all error cases gracefully (Docker unavailable, token missing, NPM unreachable).</action>
  <verify>uv run npm-cli config status displays formatted status information without errors</verify>
  <done>Status command shows NPM URL, Docker discovery result, token status, and connection test result with Rich formatting</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete NPM connection management with config init and status commands, Docker discovery, and JWT authentication</what-built>
  <how-to-verify>
    1. Run: uv run npm-cli config init
    2. Enter your NPM API URL (or use default http://localhost:81)
    3. Enter NPM username and password
    4. Verify: .env file created with NPM_ variables
    5. Verify: .env added to .gitignore (check git status doesn't show .env)
    6. Run: uv run npm-cli config status
    7. Verify: Shows NPM URL correctly
    8. Verify: Docker discovery shows container found (or appropriate message if not available)
    9. Verify: Token status shows valid token with expiry time
    10. Verify: Connection test shows success or clear error message
    11. Test error case: Delete ~/.npm-cli/token.json and run status again
    12. Verify: Shows "token missing" status appropriately
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `uv run npm-cli config init` creates .env with all fields
- [ ] .env added to .gitignore automatically
- [ ] `uv run npm-cli config status` shows formatted status
- [ ] Status command handles all error cases gracefully
- [ ] Rich formatting works correctly (colors, tables/panels)
- [ ] Manual verification checkpoint passed
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- config init provides guided .env setup
- config status shows comprehensive connection information
- Error cases handled gracefully with helpful messages
- Phase 2 complete - NPM connection and authentication working end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/02-connection-auth/02-03-SUMMARY.md`:

# Phase 2 Plan 3: CLI Commands Summary

**[One-line description of what shipped]**

## Accomplishments

- Implemented config init command for interactive setup
- Created config status command with comprehensive connection verification
- Integrated Docker discovery, token management, and NPM API testing

## Files Created/Modified

- `src/npm_cli/cli/config.py` - init and status commands with Rich formatting

## Decisions Made

[Implementation choices, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 2 complete. Ready for Phase 3: Proxy Host Management.

Dependencies met:
- NPM connection established via Docker discovery or manual URL
- JWT authentication working with token caching
- Configuration management with .env files
- CLI commands for setup and verification
</output>
