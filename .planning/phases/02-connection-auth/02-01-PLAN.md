---
phase: 02-connection-auth
type: execute
---

<objective>
Set up project dependencies and configuration management for NPM connection.

Purpose: Establish the foundation for Docker discovery and API authentication with type-safe configuration loading from .env files.
Output: Installed dependencies (docker, httpx, pydantic-settings, python-dotenv), settings module with validation, .env template for users.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-connection-auth/02-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@src/npm_cli/api/models.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install required dependencies</name>
  <files>pyproject.toml, uv.lock</files>
  <action>Add docker, httpx, pydantic-settings, and python-dotenv to project dependencies using uv. Run `uv add docker httpx pydantic-settings python-dotenv`. These provide Docker SDK for container discovery, modern HTTP client with type hints, environment-based settings management, and .env file loading respectively.</action>
  <verify>uv sync succeeds without errors, python -c "import docker; import httpx; from pydantic_settings import BaseSettings; import dotenv" runs successfully</verify>
  <done>All four dependencies installed, locked in uv.lock, and importable</done>
</task>

<task type="auto" tdd="true">
  <name>Task 2: Create settings module with Pydantic Settings</name>
  <files>src/npm_cli/config/__init__.py, src/npm_cli/config/settings.py, tests/test_config.py</files>
  <test-first>
    Test: NPMSettings loads from environment variables with validation
    Cases:
    - Valid config loads successfully
    - Invalid URL rejected (not HTTP/HTTPS)
    - Missing required fields use defaults
    - Extra fields rejected (extra="forbid")
    - NPM_API_URL validates as HttpUrl type
  </test-first>
  <action>Create config/ package. Implement NPMSettings class extending BaseSettings with fields: api_url (HttpUrl, default="http://localhost:81"), container_name (str, default="nginx-proxy-manager"), username (str | None), password (str | None), use_docker_discovery (bool, default=True). Use ConfigDict(env_file=".env", env_prefix="NPM_", extra="forbid"). Follow pattern from RESEARCH.md Pattern 4.</action>
  <verify>pytest tests/test_config.py passes all validation cases</verify>
  <done>Settings class loads from .env with type validation, rejects invalid URLs and extra fields</done>
</task>

<task type="auto">
  <name>Task 3: Create .env.example template and update .gitignore</name>
  <files>.env.example, .gitignore</files>
  <action>Create .env.example with commented template showing all NPM_ environment variables (NPM_API_URL, NPM_CONTAINER_NAME, NPM_USERNAME, NPM_PASSWORD, NPM_USE_DOCKER_DISCOVERY) with example values and descriptions. Add .env to .gitignore if not already present to prevent committing credentials.</action>
  <verify>cat .env.example shows all fields, grep -q "^\.env$" .gitignore returns success</verify>
  <done>.env.example template exists with all configuration options documented, .env added to .gitignore</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `uv sync` succeeds without errors
- [ ] All new dependencies importable
- [ ] `pytest tests/test_config.py` passes
- [ ] .env.example contains all NPM_ variables
- [ ] .env in .gitignore
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Dependencies installed and locked
- Settings module validates configuration correctly
- Users have template for creating .env file
</success_criteria>

<output>
After completion, create `.planning/phases/02-connection-auth/02-01-SUMMARY.md`:

# Phase 2 Plan 1: Configuration Setup Summary

**[One-line description of what shipped]**

## Accomplishments

- Installed dependencies: docker, httpx, pydantic-settings, python-dotenv
- Created settings module with environment variable validation
- Provided .env.example template for user configuration

## Files Created/Modified

- `pyproject.toml` - Added dependencies
- `src/npm_cli/config/settings.py` - Pydantic Settings for NPM configuration
- `tests/test_config.py` - Settings validation tests
- `.env.example` - Configuration template
- `.gitignore` - Added .env exclusion

## Decisions Made

[Configuration decisions, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 02-02-PLAN.md (Connection Core)
</output>
