---
phase: 01-foundation
type: execute
---

<objective>
Establish project structure with uv, CLI framework, and NPM API discovery foundation.

Purpose: Create the foundational infrastructure for the NPM CLI tool - project setup, dependency management, basic CLI structure, and initial API discovery. This establishes patterns all future features will build upon.

Output: Working Python project with uv, Typer CLI framework, initial NPM API authentication discovery documented, and verified project structure.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize uv project with dependencies</name>
  <files>pyproject.toml, uv.lock, src/npm_cli/__init__.py, src/npm_cli/__main__.py</files>
  <action>
Initialize Python project using uv:
1. Run `uv init --package npm-cli` to create package structure with src/ layout
2. Add dependencies: `uv add typer httpx pydantic pydantic-settings rich`
3. Add dev dependencies: `uv add --dev pytest ruff`
4. Create src/npm_cli/__main__.py with: `if __name__ == "__main__": print("NPM CLI initialized")`
5. Add [project.scripts] to pyproject.toml: `npm-cli = "npm_cli.__main__:main"`

Follow RESEARCH.md standard stack - use these exact libraries (not alternatives like click or requests).
Use Python 3.11+ (check with `uv python list`, install if needed with `uv python install 3.11`).
  </action>
  <verify>
- `uv run python -c "import typer; import httpx; import pydantic; import rich; print('All imports work')"` succeeds
- `uv run npm-cli` prints initialization message (even if just placeholder)
- `cat pyproject.toml` shows all dependencies listed
- `ls src/npm_cli/` shows __init__.py and __main__.py
  </verify>
  <done>Project initialized with uv, all dependencies installed and importable, basic structure exists</done>
</task>

<task type="auto">
  <name>Task 2: Discover and document NPM authentication API</name>
  <files>.planning/phases/01-foundation/API-DISCOVERY.md, src/npm_cli/api/models.py</files>
  <action>
Document NPM authentication endpoint through manual testing (NPM API is undocumented per RESEARCH.md):

1. Create API-DISCOVERY.md documenting findings:
   - Authentication endpoint: POST /api/tokens
   - Request format: {"identity": "email", "secret": "password"}
   - Response format: {"token": "...", "expires": "..."}
   - Token usage: Authorization: Bearer {token}
   - Known limitation: Tokens expire in 24-48 hours unless expiry explicitly set

2. Create src/npm_cli/api/models.py with Pydantic models:
   - TokenRequest(BaseModel) with identity and secret fields
   - TokenResponse(BaseModel) with token and expires fields
   - Mark both as strict models (no extra fields)

Source information from RESEARCH.md (GitHub Discussion #3265) - don't make assumptions beyond documented findings.
This is discovery documentation, not implementation - we're not connecting to NPM yet.
  </action>
  <verify>
- API-DISCOVERY.md exists and documents authentication endpoint structure
- src/npm_cli/api/models.py exists with TokenRequest and TokenResponse
- `uv run python -c "from npm_cli.api.models import TokenRequest, TokenResponse; print('Models import')"` succeeds
- Models validate correctly: `uv run python -c "from npm_cli.api.models import TokenRequest; TokenRequest(identity='test@example.com', secret='pass'); print('Valid')"`
  </verify>
  <done>NPM authentication endpoint documented, Pydantic models created and validated</done>
</task>

<task type="auto">
  <name>Task 3: Create basic CLI structure with Typer</name>
  <files>src/npm_cli/__main__.py, src/npm_cli/cli/__init__.py, src/npm_cli/cli/proxy.py, src/npm_cli/cli/cert.py, src/npm_cli/cli/config.py</files>
  <action>
Build CLI structure following Typer patterns from RESEARCH.md:

1. Update src/npm_cli/__main__.py:
   - Create main() function with typer.Typer() app
   - Add app.command() for version (shows "npm-cli 0.1.0")
   - Use Rich console for output (not print)
   - Call app() in if __name__ == "__main__"

2. Create cli subcommands:
   - src/npm_cli/cli/proxy.py: typer.Typer(help="Manage proxy hosts") with placeholder list command
   - src/npm_cli/cli/cert.py: typer.Typer(help="Manage SSL certificates") with placeholder list command
   - src/npm_cli/cli/config.py: typer.Typer(help="Manage configuration") with placeholder show command

3. Register subcommands in __main__.py:
   - app.add_typer(proxy.app, name="proxy")
   - app.add_typer(cert.app, name="cert")
   - app.add_typer(config.app, name="config")

Use type hints for all CLI arguments per RESEARCH.md pattern (not decorators with strings).
All output via Rich console (from rich.console import Console; console = Console()).
  </action>
  <verify>
- `uv run npm-cli --help` shows main help with proxy, cert, config subcommands
- `uv run npm-cli version` shows version using Rich output
- `uv run npm-cli proxy --help` shows proxy subcommand help
- `uv run npm-cli cert --help` shows cert subcommand help
- `uv run npm-cli config --help` shows config subcommand help
- All commands execute without errors (even if just placeholders)
  </verify>
  <done>CLI structure established with Typer, subcommands registered, help system working, Rich output integrated</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `uv run pytest` passes (even with 0 tests initially)
- [ ] `uv run ruff check src/` passes with no errors
- [ ] `uv run npm-cli --help` shows professional help output
- [ ] All dependencies in pyproject.toml are importable
- [ ] Project structure follows src/ layout from RESEARCH.md
- [ ] API discovery documentation exists and is accurate
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Project initialized with uv following modern Python patterns
- NPM authentication API documented from manual discovery
- CLI framework operational with subcommand structure
- No errors or warnings from ruff
- Foundation ready for Phase 2 (connection & authentication implementation)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Foundation Summary

**[One-line description of what shipped]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `pyproject.toml` - Project configuration with uv
- `src/npm_cli/__main__.py` - Main CLI entry point
- [Other files...]

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Deferred Items

[Items pushed to later phases, or "None"]

## Next Phase Readiness

Phase 1 complete. Ready for Phase 2: NPM Connection & Authentication.

Dependencies met: Foundation established, API structure discovered, CLI framework operational.
</output>
